<!--
  This page must be standalone one page documentation, so it is easy to
  maintain and distribute.
-->
<html>
<head>
  <style>
    html {
        background-color: #F8F8F8;
    }
    body {
        background-color: #FFFFFF;
        color: #000000;
        font-family: Helvetica, Arial, sans-serif;
        text-align: justify;
        line-height: 1.25;
        margin: 16px auto;
        padding: 32px;
        border: solid #ccc 1px;
        border-radius: 20px;
        max-width: 70em;
        width: 90%;
    }
    h1, h2, h3, h4 {
        color: #000080;
        font-family: Verdana, Geneva, sans-serif;
        font-weight: normal;
        font-style: normal;
        text-align: left;
    }
    table {
        border: none;
        border-spacing: 0;
        border-collapse: collapse;
    }
    tr {
        text-align: justify;
        line-height: 1.25;
        margin: 16px auto;
        padding: 32px;
        border: solid #ccc 1px;
        border-radius: 20px;
        max-width: 70em;
        width: 90%;
    }
    td {
        padding: 4px;
        margin: 0;
        border: solid #ccc 1px;
        border-radius: 20px;
    }
    td.gutter {
        width: 4%;
    }

    table.columns td {
        vertical-align: top;
        padding-bottom: 1em;
        text-align: justify;
        line-height: 1.25;
    }
  </style>
</head>
<body>

<h1> DQuest 1.0.0 — документация </h1>

<h2><a name="general">Общие понятия и концепции</a></h2>

<h3><a name="world">Экран и система координат</a></h3>

<p><strong>Игровой экран</strong> — это некоторый виртуальный экран, в котором рисуются и взаимодействуют объекты. Он может отличаться от реального экрана. Например, уровень сделан под разрешение 640x480, тогда 640x480 — это размер игрового экрана. Если запустить его в полном экране в разрешении 1920x1080, то 1920x1080 — размер реального экрана, который будет скрыт от игровой логики: все координаты и размеры будут такими, как будто бы экран имеет размеры 640x480. Это сделано для упрощения портирования игры под разные разрешения.</p>

<p>Предыдущее правило может иногда нарушаться, например, со шрифтами, которые плохо переносят сжатия и растяжения.</p>

<p>Точка отсчёта (0,0) находится в левом верхнем углу. Ось X направлена вправо, ось Y — вниз.</p>

<h3><a name="world">Мир</a></h3>

<p><strong>Игровое состояние</strong> (Game State) или <strong>мир</strong> (World) состоит из иерархического дерева сущностей. Сущностями могут быть объекты, комнаты или какие-то абстрактные понятия.</p>

<p><strong>Комната</strong> — это локация, как правило состоящая из одного экрана. В каждый момент времени есть ровно одна комната, в которой находится игрок. Подобъекты комнаты находятся в этой комнате.</p>

<p><strong>Объект</strong> (object) — это обычный игровой объект. Он рендерится, апдейтится, принимает события и взаимодействует с игроком и остальным миром.</p>

<p>У объекта есть <strong>имя</strong> (name), при помощи которого к нему можно обращаться из других объектов и скриптов. Объект может не иметь имени, тогда он является <strong>анонимным</strong>.</p>

<p>Объект может быть <strong>включён</strong> (enabled) или <strong>выключен</strong> (disabled). Выключенный объект не рисуется, не апдейтится, не может быть кликнут мышью, не получает никаких событий и т.д., но к нему можно обратиться из скриптов при помощи имени. В частности, его можно включить при помощи функции <code>enable</code>.</p>

<p>Объект может быть <strong>видимым</strong> или <strong>невидимым</strong>. Невидимый объект ведёт себя также, как и выключенный, но видимость объекта определяется автоматически движком. Например, когда игрок заходит в комнату, все объекты в ней становятся видимыми, а когда выходит — невидимыми. Кроме того, если в текущей комнате включить объект, то он станет видимым, а если выключить — невидимым.</p>

<p><strong>Взаимодействие</strong> (interaction) — ситуация, когда игрок кликнул мышью на объект или скинул на него другой объект или предмет.

<h2><a name="parameters">Конфиг</a></h2>

<p>Приложение при запуске смотрит есть ли файл <code>data/config.json</code>. Если он есть, то загружает настройки из него. Файл должен содержать json объект, поля которого задают настройки.</p>

<p>Возможные настройки:</p>

<table>
  <tr>
    <td>start_level</td>
    <td>Путь до файла со стартовым уровнем.</td>
  </tr>
  <tr>
    <td colspan="2">
      <p>&nbsp;&nbsp;Пример: <code>"data/level/animationtest0.tmx"</code></p>
    </td>
  </tr>
  <tr>
    <td>levels_filenames</td>
    <td>Задаёт список строк со всеми уровнями игры. Он нужен для того, чтобы движок закешировал уровни и поставил ресурсы в очередь на загрузку.</td>
  </tr>
  <tr>
    <td colspan="2">
      <p>&nbsp;&nbsp;Пример: <br/><code>&nbsp;&nbsp;&nbsp;&nbsp;[<br/>
      "data/level/buttontest.tmx",<br/>
      "data/level/main.tmx",<br/>
      "data/level/puzzle1.tmx",<br/>
      "data/level/rotationpule.tmx",<br/>
      "data/level/rotationtest.tmx",<br/>
      "data/level/test1.tmx"<br/>
    ]</code></p>
    </td>
  </tr>
</table>

<h2><a name="parameters">Данные</a></h2>

В этом разделе описываются данные, которые можно задать объектам.

<h3><a name="classes">Классы объектов</a></h2>

<p>Класс объекта задаётся свойством <code>class</code> и определяет его поведение с точки зрения движка. У одного объекта может быть несколько классов, перечисленных через запятую.</p>

<table>
  <tr>
    <td> interactive </td>
    <td> Объект является интерактивным. Это означает, что по нему можно кликнуть мышью или сбросить объект и у него будет вызван обработчик <code>oninteract</code>. У неинтерактивных объектов этот обработчик не вызывается, а клики мышью игнорируются. В некоторых ситуациях объект автоматически является интерактивным, даже если этот класс не задан явно. Например, если у него назначен скрипт на обработчик <code>oninteract</code>. </td>
  </tr>
  <tr>
    <td> item </td>
    <td> Объект является предметом. Это значит, что при взаимодействии он подбирается в инвентарь. Указание этого класса автоматически делает объект интерактивным. </td>
  </tr>
  <tr>
    <td> draganddrop </td>
    <td> Объект можно таскать мышью. Указание этого класса автоматически делает объект интерактивным. </td>
  </tr>
  <tr>
    <td> room </td>
    <td> Объект является комнатой </td>
  </tr>
  <tr>
    <td> background </td>
    <td> Объект задаёт фон на всю комнату </td>
  </tr>
  <tr>
    <td> portal </td>
    <td> Объект является порталом в другую комнату </td>
  </tr>
  <tr>
    <td> exchangable </td>
    <td> Объект можно обменять местами с другим exchangable объектом </td>
  </tr>
  <tr>
    <td> rotable </td>
    <td> Объект можно вращать (как вентель) </td>
  </tr>
</table>

<h3><a name="properties">Свойства объектов</a></h2>

<table>
  <tr>
    <td> name </td>
    <td> Имя объекта, по которому его можно находить из скриптов </td>
  </tr>
  <tr>
    <td> class </td>
    <td> Класс или список классов объекта </td>
  </tr>
  <tr>
    <td> x </td>
    <td> Координата по x (в пикселях) </td>
  </tr>
  <tr>
    <td> y </td>
    <td> Координата по y (в пикселях) </td>
  </tr>
  <tr>
    <td> width </td>
    <td> Ширина объекта (в пикселях) </td>
  </tr>
  <tr>
    <td> height </td>
    <td> Высота объекта (в пикселях) </td>
  </tr>
  <tr>
    <td> enabled </td>
    <td> Включён ли объект изначально, 0 — выключён (по умолчанию 1 — включён) </td>
  </tr>
  <tr>
    <td> parent </td>
    <td> Родитель объекта (по умолчанию родителем является комната) </td>
  </tr>
  <tr>
    <td> alwaysdropback </td>
    <td> Если 1, то таскаемый объект всегда возвращается на место, если 0, то остаётся там где его кинули </td>
  </tr>
  <tr>
    <td> dragbounds </td>
    <td> Границы, в которых можно таскать объект </td>
  </tr>
</table>

<h3><a name="events">События объектов</a></h2>

<table>
  <tr>
    <td> oninteract </td>
    <td> Игрок кликнул на объект или скинул другой другой объект </td>
  </tr>
  <tr>
    <td> onenable </td>
    <td> Объект стал активным </td>
  </tr>
  <tr>
    <td> onhover </td>
    <td> Над объектом провели мышью </td>
  </tr>
  <tr>
    <td> onglobalvisiblechange </td>
    <td> Поменялась видимость у каких-то объектов комнаты </td>
  </tr>
  <tr>
    <td> onupdate </td>
    <td> Вызывается каждый объект </td>
  </tr>
  <tr>
    <td> ondrag </td>
    <td> Объект сдвинулся в результате перетаскивания </td>
  </tr>
</table>

<h3><a name="functions">Функции</a></h2>

<table>
  <tr>
    <td> log </td>
    <td> Печатает строку в лог </td>
  </tr>
  <tr>
    <td> isenabled </td>
    <td> Проверяет включен ли заданный объект </td>
  </tr>
  <tr>
    <td> isdisabled </td>
    <td> Проверяет выключен ли заданный объект </td>
  </tr>
  <tr>
    <td> enable </td>
    <td> Включает заданный объект </td>
  </tr>
  <tr>
    <td> disable </td>
    <td> Выключает заданный объект </td>
  </tr>
  <tr>
    <td> moveto </td>
    <td> Осуществляет переход в другую комнату </td>
  </tr>
  <tr>
    <td> setproperty </td>
    <td> Устанавливает свойство объекту </td>
  </tr>
  <tr>
    <td> getproperty </td>
    <td> Возвращает свойство объекта </td>
  </tr>
  <tr>
    <td> gettimer </td>
    <td> Возвращает число-таймер в миллисекундах </td>
  </tr>
  <tr>
    <td> setanimationtime </td>
    <td> Выставляет время анимации у заданного объекта </td>
  </tr>
</table>

</body>
</html>

